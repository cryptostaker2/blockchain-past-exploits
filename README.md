# Blockchain Past Exploits
All blockchain past exploits, with PoCs and in-depth explanation

## Summary


[24082023 GSS Token Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/gss)
<br>
[27072023 SUT Token Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/sut)
<br>
[07072023 LUSD Protocol Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/lusd)
<br>
[24062023 Shido Protocol Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/shido)
<br>
[29052023 FAPEN Token Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/fapen)
<br>
[25052023 CNN Token Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/cnn)


# Binance Smart Chain (BSC) Past Exploits

 ## GSS Token Exploit (BSC), 24 August 2023  - oversight in _transfer() function which can be abused by using skim()

 ### Summary 

 - The attacker flashloan 30,000 BUSDT from DODOOracle and swapped everything to GSS tokens using the BUSDT-GSS Pair on Pancakeswap. The attacker obtained 725,246 GSS tokens.
 - The attacker transferred 1 wei of GSS token to the 0x01 precompile address and 707,162 GSS tokens directly to the Pair address
 - The attacker calls skim with another Pair address (GSS-LP) as the input and sync. **The issue lies in the GSS `_transfer()` function**. `_transfer()` takes in 3 parameters: from, to, and amount. If the from or the to address is either the BUSDT-GSS pair or the GSS-LP pair, transfer the token.
 - Because `from` is the BUSDT-GSS address and `to` is the GSS-LP address, **707,162 tokens is withdrawn twice** from the original pool when calling skim.  
 - The attacker calls sync, and then call skim() on the other Pair address with the attack contract as the input address 
 - The attacker converts all his GSS tokens back to BUSDT tokens, netting him 24883 BUSDT tokens after repaying the flashloan
 - Total loss: **24,883 BUSDT**

 ### Proof of Concept

 [gss.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/gss/gss.t.sol)

 ### More Details

[GSS Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/gss)

## SUT Token Exploit (BSC), 21 July 2023 - Fixed Token Sale Exploit

 #### Summary

 - SUT token can be bought at a fixed price 
 - There's a liquidity pool with SUT and WBNB
 - At one point, the price of SUT in the liquidity pool is higher than the fixed price
 - Attacker flashloaned 10 BNB from DPPOracle (Dodo Private Pool) and arbitrage the difference in price
 - Total loss: **32 BNB (~7k USD)**

### Proof of Concept 

[sut.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/sut/sut.t.sol)

### More Details

[SUT Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/sut)

## LUSD Protocol Exploit (BSC), 07 July 2023 - Internal Oracle Price Manipulation

### Summary 

- Attacker gets a ~3.5m BUSD flashloan from 5 different DODO oracles
- Attacker calls a flashswap on the BUSD-BTCB pair and withdraws 1.2 BTC
- Attacker transfers 800,000 BUSD to the pair through the `pancakeCall()` callback function
- Originally, one BTC was worth ~30k. After the transfer, 1 BTC is worth ~11m
- Attacker calls `supply()` on the Loan contract and mints 10,000 LUSD with 0.0015 BTC. This works because the `supply()` function checks the price of BTCB in terms of BUSD. Since the price was manipulated in the first swap, 1 BTC is worth a lot now
- Attacker calls `withdraw()` on the LUSDPool contract. 1 LUSD is pegged to 1 BUSD, so the attacker manages to withdraw 10,000 BUSD. The reason why the attacker only can withdraw 10,000 BUSD is because the LUSDPool contract only have 10,000 BUSD inside at the moment of the attack
- Attacker transfers 1.2 BTC back to the BUSD-BTCB pair
- Attacker calls a flashswap again, this time without a callback on the BUSD-BTCB pair and withdraws 799,794 BUSD
- Attacker repays the 3.5m flashloan and profitted ~9.5k BUSD.
- Total loss: **~9.5k BUSD**

 ### Proof of Concept

 [lusd.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/lusd/lusd.t.sol)

### More Details

[LUSD Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/lusd)

 ## Shido Protocol Exploit (BSC), 24 June 2023 - V1 to V2 Migration Attack

 ### Summary 

 - Attacker flashloaned 40 BNB from DODO Oracle
 - Attacker swapped 39 BNB for 10 billion SHIDO, **the receiver is AddRemoveLiquidityForFeeOnTransferTokens contract**
(It is unclear how the receiver gets 10 billion SHIDO by swapping 39 BNB, but when any other contracts swap 39 BNB to shido, they get 10 million SHIDO instead)
 - The attacker converts 0.01 WBNB to 0.01 BNB 
 - The attacker swaps 0.1 BNB and receives ~14m SHIDO
 - The attacker sets up a new liquidity pool and deposits 0.01 BNB and 1m SHIDO 
 (The purpose of creating an LP is to withdraw the 10 billion SHIDO from the AddRemoveLiquidityForFeeOnTransferTokens contract)
 - The attacker calls `lockTokens()` and `claimTokens()` in the ShidoLock contract. This swaps the V1 Shido to the V2 Shido tokens at a 1:1 exchange rate
 - The attacker swaps 10 billion SHIDOV2 and receives 1,0169 BNB
 - The attacker repays the 40 BNB flashloan and pockets ~997 BNB
- Total loss: **997 BNB (~238k USD)**
 
 ### Proof of Concept

 [shido.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/shido/shido.t.sol)

 ### More Details

[Shido Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/shido)

 ## FAPEN Token Exploit (BSC), 29 May 2023 - Wrong check in unstake() function

 ### Summary 
 
 - The attacker found a flaw in the `unstake()` function in the FAPEN token contract. This flaw allowed him to withdraw all the tokens in the FAPEN contract, which was about 9,521,992 tokens (note that FAPEN has [9 decimals](https://bscscan.com/address/0xf3f1abae8bfeca054b330c379794a7bf84988228#readContract))
 - The attacker then swapped all the FAPEN tokens for WBNB using Pancakeswap FAPEN-WBNB pair via the swapTokensForETH route
 - The WBNB tokens that were swapped to were exchanged for BNB tokens
 - Total loss: **2.04 WBNB (~600 USD)**

  ### Proof of Concept

 [fapen.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/fapen/fapen.t.sol)

 ### More Details

[Fapen Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/fapen)

 ## CNN Token Exploit (BSC), 25 May 2023 - Logic Flaw in buy() function 

 ### Summary 
 
 - NOTE: The Actual Exploited Contract is Unknown. The exploit is obtained through evidence from the transaction history
 - The attacker flashloaned 15,000 BUSDT from DODO Oracle
 - The attacker swaps 15,000 BUSDT for ~660,859 CNN tokens
 - The attacker calls the `buy()` function of an unknown contract. This function swaps 5600 BUSDT for ~7,070 CNN tokens
 - The attacker swapped back all his CNN tokens for 20,573 BUSDT 
 - The attacker repays the 15,000 flashloan and keeps 5,573 BUSDT
 - Total loss: **~5,575 BUSDT**

  ### Proof of Concept

 [cnn.t.sol](https://github.com/cryptostaker2/blockchain-past-exploits/blob/main/bsc/test/cnn/cnn.t.sol)

  ### More Details

[Cnn Exploit](https://github.com/cryptostaker2/blockchain-past-exploits/tree/main/bsc/test/cnn)

